<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="../css/style.css">
    <title>Aagneya</title>
    <style>
        [x-cloak] {
            display: none
        }
    </style>

    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>

    <script src="//unpkg.com/alpinejs" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.2/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .vote-icon {
            width: 24px;
            height: 24px;
            fill: currentColor;
            transition: transform 0.2s ease-in-out;
        }
        
        .vote-icon:hover {
            transform: scale(1.2);
        }
        
        .card {
            position: relative;
        }
        
        .position-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
    </style>
    <!-- <style>
        .card:hover {
            transform: translateY(-5px);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style> -->
    <style>
        .heart:hover {
            transform: scale(1.1);
            transition: transform 0.3s ease;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        [x-cloak] {
            display: none
        }
    </style>
    <script src="//unpkg.com/alpinejs" defer></script>
</head>


<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <a href="#" class="logo">
            <i class='bx bx-code-alt'></i>
            <div class="logo-name"><span>Aag</span>neya</div>
        </a>
        <ul class="side-menu">
            <li><a href="../dashboard.html"><i class='bx bxs-dashboard'></i>Dashboard</a></li>
            <li><a href="../event.html"><i class='bx bx-calendar-event'></i>Events</a></li>
            <li><a href="../achivement.html"><i class='bx bx-medal'></i>Achievement</a></li>
            <li><a href="#"><i class='bx bx-news'></i>Blog</a></li>

            <li class="active"><a href="#" class="toggle-submenu" data-target="community"><i class='bx bx-category-alt'></i>Community <i class='bx bx-chevron-down'></i> </a> </li>
            <ul class="submenu" id="community-submenu">
                <li><a href="./voting.html"><i class='bx bxl-graphql'></i>Stats</a></li>
                <li><a href="./president.html"><i class='bx bx-crown'></i>President</a></li>
                <li><a href="./vicepresident.html"><i class='bx bx-star'></i>Vice President</a></li>
                <li><a href="./secretary.html"><i class='bx bx-notepad'></i>Secretary</a></li>
                <li><a href="./pulicrelation.html"><i class='bx bx-broadcast'></i>Public Relation</a></li>
            </ul>
            <li><a href="../editprofile.html"><i class='bx bx-cog'></i>Settings</a></li>
        </ul>


        <ul class="side-menu">
            <li>
                <a href="#" class="logout" onclick="logout()"><i class='bx bx-log-out-circle'></i> Logout </a>
            </li>
        </ul>
    </div>
    <!-- End of Sidebar -->

    <!-- Main Content -->
    <div class="content">
        <!-- Navbar -->
        <nav>
            <i class='bx bx-menu'></i>
            <form action="#">
                <div class="form-input">
                    <!-- <input type="search" placeholder="Search..."> -->
                    <button style="background-color: transparent; color: #1976d2; width: fit-content;">Hi , <span id="name"> Name</span></button>
                </div>
            </form>
            <input type="checkbox" id="theme-toggle" hidden>
            <!-- <label for="theme-toggle" class="theme-toggle"></label> -->
            <a href="#" class="notif">
                <i class='bx bx-bell'></i>
                <span class="count">12</span>
            </a>
            <!-- <a href="#" class="profile">
                <img src="images/logo.png">
            </a> -->
        </nav>

        <!-- End of Navbar -->

        <main>
            <div class="header">
                <div class="left">
                    <h1>Dashboard</h1>
                    <ul class="breadcrumb">
                        <li><a href="#">
                                Analytics
                            </a></li>
                        /
                        <li><a href="#" class="active">Shop</a></li>
                    </ul>
                </div>

            </div>
            <br>
            <!-- code from here -->

            <div class="flex justify-center items-center" id="msgok" style="display:none ;">
                <div class="flex flex-col gap-2 w-60 sm:w-72 text-[10px] sm:text-xs z-50">
                    <div class="success-alert cursor-default flex items-center justify-between w-full h-12 sm:h-14 rounded-lg bg-[#232531] px-[10px]">
                        <div class="flex gap-2">
                            <div class="text-[#2b9875] bg-white/5 backdrop-blur-xl p-1 rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-white">Activated successfully :)</p>
                                <p class="text-gray-500" id="Msg">User activated</p>
                            </div>
                        </div>
                        <button class="text-gray-600 text-gray-600 hover:bg-white/5 p-1 rounded-md transition-colors ease-linear">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>


            <div class="flex justify-center items-center flex-col gap-2  text-[10px] " id="msgfail" style="display: none;">
                <div class="error-alert cursor-default flex items-center justify-between w-full h-12 sm:h-14 rounded-lg bg-[#232531] px-[10px]">
                    <div class="flex gap-2">
                        <div class="text-[#d65563] bg-white/5 backdrop-blur-xl p-1 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"
                                ></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-white">Please try again</p>
                            <p class="text-gray-500" id="Msgerr">This is the description part</p>
                        </div>
                    </div>
                    <button class="text-gray-600 hover:bg-white/10 p-1 rounded-md transition-colors ease-linear">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke-width="1.5"
                          stroke="currentColor"
                          class="w-6 h-6"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 18 18 6M6 6l12 12"
                          ></path>
                        </svg>
                    </button>
                </div>
            </div>


            <div class="flex justify-center items-center" id="msgok" style="display:none ;">
                <div class="flex flex-col gap-2 w-60 sm:w-72 text-[10px] sm:text-xs z-50">
                    <div class="success-alert cursor-default flex items-center justify-between w-full h-12 sm:h-14 rounded-lg bg-[#232531] px-[10px]">
                        <div class="flex gap-2">
                            <div class="text-[#2b9875] bg-white/5 backdrop-blur-xl p-1 rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-white">Activated successfully :)</p>
                                <p class="text-gray-500" id="Msg">User activated</p>
                            </div>
                        </div>
                        <button class="text-gray-600 text-gray-600 hover:bg-white/5 p-1 rounded-md transition-colors ease-linear">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>


            <div class="flex justify-center items-center flex-col gap-2  text-[10px] " id="msgfail" style="display: none;">
                <div class="error-alert cursor-default flex items-center justify-between w-full h-12 sm:h-14 rounded-lg bg-[#232531] px-[10px]">
                    <div class="flex gap-2">
                        <div class="text-[#d65563] bg-white/5 backdrop-blur-xl p-1 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"
                                ></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-white">Please try again</p>
                            <p class="text-gray-500" id="Msgerr">This is the description part</p>
                        </div>
                    </div>
                    <button class="text-gray-600 hover:bg-white/10 p-1 rounded-md transition-colors ease-linear">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke-width="1.5"
                          stroke="currentColor"
                          class="w-6 h-6"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 18 18 6M6 6l12 12"
                          ></path>
                        </svg>
                    </button>
                </div>
            </div>


            <br>


            <div class="relative min-h-screen bg-gray-100 dark:bg-gray-900" id="seprate">

                <section class="container px-4 mx-auto">
                    <div class="sm:flex sm:items-center sm:justify-between"></div>

                    <!-- Buttons for toggling sections -->

                    <div class="mt-6 md:flex md:items-center md:justify-start">
                        <div class="inline-flex overflow-hidden bg-white border divide-x rounded-lg dark:bg-gray-900 rtl:flex-row-reverse dark:border-gray-700 dark:divide-gray-700">
                            <button id="viewAllSectionBtn" class="toggle-btn px-5 py-2 text-xs font-medium text-gray-600 transition-colors duration-200 bg-gray-100 sm:text-sm dark:bg-gray-800 dark:text-gray-300 active">
                                            Boys
                                        </button>
                            <button id="monitoredSectionBtn" class="toggle-btn px-5 py-2 text-xs font-medium text-gray-600 transition-colors duration-200 sm:text-sm dark:hover:bg-gray-800 dark:text-gray-300 hover:bg-gray-100">
                                            Girls
                                        </button>
                            <button id="unmonitoredSectionBtn" class="toggle-btn px-5 py-2 text-xs font-medium text-gray-600 transition-colors duration-200 sm:text-sm dark:hover:bg-gray-800 dark:text-gray-300 hover:bg-gray-100" style="display: none;">
                                            Unmonitored
                                        </button>
                        </div>
                    </div>





                    <!-- Sections to toggle visibility -->
                    <div id="viewAllSection" class="flex flex-col mt-6">

                        <!-- info to backend -->

                        <!-- flex justify-between items-center pt-4  - after vote
                        text-center   - init -->
                        <!-- id name of div votechange -->
                        <!-- vote div -     <div class="flex items-center space-x-2">
                            <i class="heart fas fa-heart text-purple-700"></i>
                            <span class="text-sm sm:text-base dark:text-gray-600">80 votes</span>
                        </div> -->

                        <!-- id votewinner -->
                        <!-- <div class="position-badge" id="votewinner">
                            <i class="bi bi-trophy-fill" style="color: gold; font-size: x-large;"></i>
                        </div> -->

                        <div class="flex justify-end p-2">

                            <select name="year" id="year-select" class="year_election mt-4 md:mt-1 block w-full md:w-1/3 rounded-md border border-gray-300 bg-white px-3 py-2 sm:py-4 placeholder-gray-400 shadow-sm placeholder-semibold text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 sm:text-sm"
                                required>
                                <option value="" disabled selected>select Year</option>
                            </select>

                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 justify-center" id="showelectioncardboy">


                        </div>


                    </div>


                    <div id="monitoredSection" class="flex flex-col mt-6 hidden fade-in">


                        <div class="flex justify-end p-2">

                            <select name="year" class="year_election mt-4 md:mt-1 block w-full md:w-1/3 rounded-md border border-gray-300 bg-white px-3 py-2 sm:py-4 placeholder-gray-400 shadow-sm placeholder-semibold text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 sm:text-sm"
                                required>
                                <option value="" disabled selected>select Year</option>
                            </select>

                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 justify-center" id="showelectioncardgirl">

                        </div>

                    </div>

                    <div id="unmonitoredSection" class="flex flex-col mt-6 hidden fade-in">
                        <p>Unmonitored section content goes here.</p>
                    </div>
                </section>





            </div>



        </main>

    </div>


    <div id="loading-spinner" class="hidden">
        <svg aria-hidden="true" class="w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>
            <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>
        </svg>
        <span class="sr-only">Loading...</span>
    </div>

    <style>
        #loading-spinner {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.7);
            /* Semi-transparent background */
            z-index: 9999;
            /* Make sure it's on top */
            position: fixed;
            /* Fixed position to cover the screen */
            inset: 0;
            /* Cover the entire viewport */
        }
        
        .hidden {
            display: none;
        }
    </style>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>


    <script src="../js/index.js"></script>
</body>

</html>



<script>
    let roll_no;
    let name;
    let token;
    let vote;
    let years;
    const role = 2;

    async function decodeToken() {
        const spinner = document.getElementById('loading-spinner');
        spinner.style.display = 'flex'; // Show the spinner

        try {
            token = localStorage.getItem('token');
            console.log('Token from localStorage:', token);

            if (!token) {
                console.error('Token not found in local storage');
                window.location.href = '../../login/login.html';
                return;
            }

            const response = await fetch('https://aagneya-backend.onrender.com/api/decodeToken', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    token: token
                })
            });

            if (response.ok) {
                const data = await response.json();
                console.log('Decoded token data:', data);

                // Example of handling the decoded data
                roll_no = data.roll_no;
                name = data.name;

                if (data.is_active === 1) {
                    if (data.role_id === 0) {
                        console.log("Hello admin");

                        // Example of updating UI with user's name
                        const nameElement = document.getElementById('name');
                        nameElement.textContent = name;
                        getelection();

                    } else {
                        window.location.href = '../../User Dashboard';
                    }
                } else {
                    console.error('User is not active');
                    window.location.href = '../../../login/login.html';

                }

            } else {
                console.error('Failed to decode token:', response.statusText);
                // window.location.href = '../../../login/login.html';
            }
        } catch (error) {
            console.error('Error in decodeToken:', error.message);
            // window.location.href = '../../../login/login.html';

        } finally {
            spinner.style.display = 'none'; // Hide the spinner
        }
    }



    // Function to fetch and populate the <select> elements
    async function getelection() {

        const spinner = document.getElementById('loading-spinner');
        spinner.style.display = 'flex'; // Show the spinner

        try {
            const response = await fetch('https://aagneya-backend.onrender.com/api/electionyear', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!response.ok) {
                throw new Error('Failed to fetch election data');
            }

            const responseData = await response.json();
            const data = responseData.data; // Assuming 'data' is the array of election years

            console.log('election data:', data);


            // Select all elements with class "year_election"
            const yearSelects = document.querySelectorAll('.year_election');

            // Determine the default year to display
            let defaultYear = null;

            // Find the first year with is_register === 1 or is_vote === 1
            const validYears = data.filter(election => election.is_register === 1 || election.is_vote === 1);

            if (validYears.length > 0) {
                defaultYear = validYears[0].year;
                console.log('Default year:', defaultYear);
                electionppl(defaultYear)


            } else {
                // If no years match, display the maximum year
                defaultYear = Math.max(...data.map(election => election.year));
                console.log('Default year max:', defaultYear); // Log the default year to console
                electionppl(defaultYear)

            }



            // Populate each <select> element with the fetched data
            yearSelects.forEach(select => {
                // Clear existing options except the default placeholder
                select.innerHTML = '<option value="" disabled selected>select Year</option>';

                // Populate with fetched data
                data.forEach(election => {
                    const option = document.createElement('option');
                    option.textContent = election.year;
                    option.value = election.year;
                    select.appendChild(option);
                });

                // Set the selected option based on the determined defaultYear
                select.value = defaultYear;

                // Add change event listener to synchronize selection
                select.addEventListener('change', function() {
                    // Update all other <select> elements

                    yearSelects.forEach(otherSelect => {
                        if (otherSelect !== select) {
                            otherSelect.value = select.value;
                            console.log("changed yr: ", otherSelect.value)
                            electionppl(otherSelect.value)
                        }
                    });
                });
            });

        } catch (error) {
            console.error('Error fetching election data:', error);
            // Handle error gracefully
            throw error;
        } finally {
            spinner.style.display = 'none'; // Hide the spinner
        }
    }


    // Logic for vote
    async function electionppl(year) {
        let maleResults, femaleResults; // Declare here to ensure availability throughout the function
        const spinner = document.getElementById('loading-spinner');
        spinner.style.display = 'flex'; // Show the spinner

        try {
            const response = await fetch('https://aagneya-backend.onrender.com/api/electionroleppl', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    year: year
                })
            });

            if (!response.ok) {
                throw new Error('Failed to fetch election data');
            }

            const data = await response.json();
            console.log('election ppl data:', data);

            let boysVote = data.votestatus;
            let girlsVote = data.votestatus;
            const spinner = document.getElementById('loading-spinner');
            spinner.style.display = 'flex'; // Show the spinner

            try {
                const response = await fetch('https://aagneya-backend.onrender.com/api/votecheck', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        year: year,
                        roll_no: roll_no
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch vote data');
                }

                const datas = await response.json();
                console.log('ur vote data:', datas);
                years = year;

                const boysVoted = datas.some(candidate => candidate.role_id === role && candidate.gender === 'Boys');
                const girlsVoted = datas.some(candidate => candidate.role_id === role && candidate.gender === 'Girls');

                if (boysVoted) {
                    console.log('Voting for boys is over.');
                    boysVote = 3; // Set vote to 3 if voting for boys is over
                }

                if (girlsVoted) {
                    console.log('Voting for girls is over.');
                    girlsVote = 3; // Set vote to 3 if voting for girls is over
                }

                if (boysVote === 0 || girlsVote === 0) {
                    boysVote = girlsVote = 0; // Set both to 0 if either is 0
                }

                if (boysVote === 2 || girlsVote === 2) {
                    boysVote = girlsVote = 2; // Set both to 2 if either is 2
                    const spinner = document.getElementById('loading-spinner');
                    spinner.style.display = 'flex'; // Show the spinner

                    try {
                        const response = await fetch('https://aagneya-backend.onrender.com/api/viewvoteresult', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({
                                year: year
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }

                        const data = await response.json();
                        console.log('Response data:', data);

                        const filteredResults = data.results.filter(result => result.role_id === role);

                        if (filteredResults.length > 0) {
                            const roleData = filteredResults[0];
                            roleData.gender.forEach(genderObj => {
                                if (genderObj.hasOwnProperty('Boys')) {
                                    maleResults = genderObj.Boys;
                                } else if (genderObj.hasOwnProperty('Girls')) {
                                    femaleResults = genderObj.Girls;
                                }
                            });

                            console.log('Male results:', maleResults);
                            console.log('Female results:', femaleResults);

                        } else {
                            console.log(`No results found for role_id ${role}`);
                        }

                    } catch (error) {
                        console.error('Error:', error.message);
                    } finally {
                        spinner.style.display = 'none'; // Hide the spinner
                    }

                }

            } catch (error) {
                console.error('Error fetching vote data:', error);
                throw error;
            } finally {
                spinner.style.display = 'none'; // Hide the spinner
            }

            console.log('Final vote status for boys:', boysVote);
            console.log('Final vote status for girls:', girlsVote);

            function createCandidateCardHTML(candidate, vote, results, isTopVoter) {
                let voterBtnHTML = '';

                if (vote === 0) {
                    voterBtnHTML = ``;
                } else if (vote === 1) {
                    voterBtnHTML = ``;
                } else if (vote === 2) {
                    let voteCount = 0;
                    results.vote_results.forEach(result => {
                        if (result.candidate_id === candidate.candidate_id) {
                            voteCount = result.vote_count;
                        }
                    });

                    voterBtnHTML = ``;
                } else if (vote === 3) {
                    voterBtnHTML = `<div id="voterbtn">
                    <div class="text-center pt-4">
                        <button class="rounded-lg bg-purple-300 px-6 py-2 sm:py-3 text-sm font-semibold text-white mr-4 disabled:opacity-50 cursor-not-allowed transition-all transform hover:scale-105 disabled:text-red-600">Vote</button>
                   </div>
                 </div>`;
                }

                return `
        <div class="card flex flex-col justify-center max-w-xs p-6 shadow-md rounded-xl sm:px-7 m-4 bg-white dark:bg-gray-50">
                 ${isTopVoter ? '<div class="position-badge" id="votewinner"><i class="bi bi-trophy-fill" style="color: gold; font-size: x-large;"></i></div>' : ''}
                 <img src="https://aagneya-backend.onrender.com/${candidate.profile.photo_path}" style="height: fit-content;" alt="" class="mx-auto aspect-square">
        <div class="space-y-4 text-center divide-y dark:divide-gray-300">
      <div class="my-2 space-y-1">
                <h2 class="text-xl font-semibold sm:text-2xl">${candidate.profile.name}</h2>
              <p class="px-5 text-xs sm:text-base dark:text-gray-600">${candidate.profile.roll_no}</p>
     </div>
          ${voterBtnHTML}
     </div>
    </div>`;
            }

            function findTopVoter(results) {
                let topVoteCount = 0;
                results.vote_results.forEach(result => {
                    if (result.vote_count > topVoteCount) {
                        topVoteCount = result.vote_count;
                    }
                });
                return topVoteCount;
            }

            const topMaleVotes = findTopVoter(maleResults || {
                vote_results: []
            });
            const topFemaleVotes = findTopVoter(femaleResults || {
                vote_results: []
            });

            const boysContainer = document.getElementById('showelectioncardboy');
            const girlsContainer = document.getElementById('showelectioncardgirl');
            boysContainer.innerHTML = '';
            girlsContainer.innerHTML = '';

            if (data.boys && data.boys.length > 0) {
                data.boys.forEach(boy => {
                    if (boy.role_id === role) {
                        const isTopVoter = maleResults && maleResults.vote_results.some(result => result.vote_count === topMaleVotes && result.candidate_id === boy.candidate_id);
                        boysContainer.innerHTML += createCandidateCardHTML(boy, boysVote, maleResults, isTopVoter);
                    }
                });
            }

            if (data.girls && data.girls.length > 0) {
                data.girls.forEach(girl => {
                    if (girl.role_id === role) {
                        const isTopVoter = femaleResults && femaleResults.vote_results.some(result => result.vote_count === topFemaleVotes && result.candidate_id === girl.candidate_id);
                        girlsContainer.innerHTML += createCandidateCardHTML(girl, girlsVote, femaleResults, isTopVoter);
                    }
                });
            }

        } catch (error) {
            console.error('Error fetching election data:', error);
            throw error;
        } finally {
            spinner.style.display = 'none'; // Hide the spinner
        }
    }


    // Function to handle voting action
    async function voteForCandidate(candidateid) {
        console.log(`Vote button clicked for candidate: ${candidateid}`);
        // Here you can add further logic for voting functionality
        const spinner = document.getElementById('loading-spinner');
        spinner.style.display = 'flex'; // Show the spinner

        try {
            const response = await fetch('https://aagneya-backend.onrender.com/api/vote', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    year: years,
                    roll_no: roll_no,
                    candidate_id: candidateid,
                    role_id: role

                })
            });

            if (response.ok) {
                const responseData = await response.json();
                console.log('Success:', responseData);

                // Assuming you have an element with id 'msgok' and 'Msg' to show the message
                const successMsg = document.getElementById('msgok');
                const message = responseData.message; // Extract message from response
                console.log(message);
                document.getElementById('Msg').textContent = message; // Update message content dynamically

                successMsg.style.display = 'flex';
                setTimeout(function() {
                    successMsg.style.display = 'none';
                }, 3000); // Hide after 3 seconds
                electionppl(years)


            } else {
                // Show the failure message
                const failMsg = document.getElementById('msgfail');
                let responseData = {};
                const spinner = document.getElementById('loading-spinner');
                spinner.style.display = 'flex'; // Show the spinner

                try {
                    responseData = await response.json(); // Try to parse response JSON
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                } finally {
                    spinner.style.display = 'none'; // Hide the spinner
                }

                const error = responseData.error || 'Failed to get error message'; // Extract error message or provide a default
                console.log(error);
                document.getElementById('Msgerr').textContent = error; // Update error message content dynamically

                if (failMsg) {
                    failMsg.style.display = 'flex';
                    setTimeout(() => {
                        failMsg.style.display = 'none';
                    }, 3000); // Hide after 3 seconds
                }
                throw new Error('Network response was not ok');
            }
        } catch (error) {
            console.error('Error updating user details:', error);
        } finally {
            spinner.style.display = 'none'; // Hide the spinner
        }
    }





    window.onload = function() {
        decodeToken();
    };
</script>


<script>
    document.getElementById('dropdownButton').addEventListener('click', function() {
        var dropdownContent = document.getElementById('dropdownContent');
        dropdownContent.classList.toggle('show');
    });

    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
        if (!event.target.matches('#dropdownButton')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            for (var i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }
    document.getElementById('dropdownButton1').addEventListener('click', function() {
        var dropdownContent = document.getElementById('dropdownContent1');
        dropdownContent.classList.toggle('show');
    });

    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
        if (!event.target.matches('#dropdownButton1')) {
            var dropdowns = document.getElementsByClassName("dropdown-content1");
            for (var i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }
</script>


<script>
    function logout() {
        // Remove token from local storage
        localStorage.removeItem('token');

        // Redirect to index.html
        window.location.href = '../../login/login.html';
    }
</script>